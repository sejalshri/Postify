<!DOCTYPE html>
    <html lang="en">
    
        <head>
            <meta charset="UTF-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="undefined" crossorigin="anonymous">
            <link rel="preconnect" href="https://fonts.gstatic.com">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="css/home.css">
            <script src="https://use.fontawesome.com/fbf48fd1fe.js"></script>
            <title>Postify</title>
        </head>
        <body>
            <nav>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/<%=nav2h%>"><%=nav2%></a></li>
                    <li><a href="/<%=nav3h%>"><%=nav3%></a></li>
                </ul>
            </nav>
            <div class="container" style="color: white;">
                <% items.forEach(function(image) { %>
                    <div>
                        <div class="post">
                            <div>
                                <h2><%= image.username %></h2>
                            </div>
                            <div>
                                <small><%= image.date %></small>
                            </div>
                            <div>
                                <h4><%= image.title %></h4>
                            </div>
                            <div>
                                <p><%= image.description %></p>
                            </div>
                            <img src="data:image/<%=image.img.contentType%>;base64,
                                 <%=image.img.data.toString('base64')%>" style="width: 400px; height:200px;">
                                 <div>
                                     <% image.comments.forEach(function(comments) {%>
                                         <span><%= comments.user %></span>
                                         <span><%= comments.comment %></span>
                                     <%})%>
                                 </div>
                                <form class="pure-form" id="comment-form" method="POST" action="/comment">
                                    <div class="comment-form" id="div<%=image._id%>">
                                        <input type="string" name="comment" placeholder="enter comment" id="comment<%=image._id%>">
                                        <button type="submit" class="button-secondary pure-button" id="<%=image._id%>" onclick="addNewComment(this)">Send Comment</button>
                                    </div>
                                </form>
                            <div>

                            </div>
                        </div>
                            <% }) %>
                            
                    </div>
            </div>
                    <script type="text/javascript" src="https://js.pusher.com/3.2/pusher.min.js"></script>
                    <script>
                    (function(){
                        // Enable pusher logging - don't include this in production
                        //Pusher.logToConsole = true;
                            var serverUrl = "/",
                            comments = [],
                            pusher = new Pusher('1f3855a8c5dd212f690d', {
                              cluster: 'ap2',
                              encrypted: true
                            }),
                            channel = pusher.subscribe('Postify');
                            channel.bind('new_comment',newCommentReceived);
                        })();
                        function newCommentReceived(data,id){
                          console.log(id);
                          console.log(data);
                          let str2="div"+id;
                          var para = document.createElement("div");
                          var node = document.createTextNode(data.comment);
                          para.appendChild(node);
                          var element = document.getElementById(str2);
                          element.appendChild(para);
                        }
                    
                        function addNewComment(thiss){
                            let str1="comment"+thiss.id;
                            //console.log(str);
                            //commentForm = document.getElementById('comment-form'),
                            console.log( document.getElementById(thiss.id));
                          event.preventDefault();
                          var newComment = {
                            "comment": document.getElementById(str1).value
                          }
                          console.log(JSON.stringify(newComment));
                            newCommentReceived(newComment,thiss.id);
                        }
                    </script>
                </body>
                </html>
